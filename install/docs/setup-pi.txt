dd image on to micro-sd card.

raspi-config :
    expand the file system
    change user "pi" password
    boot option to console with password
    advanced options
        change hostname
        i2c enable
        ssh-login-enable.

    get the mac-address and add a dhcp config in the tp-link so it will always get the same ip-address.

    copy over the ssh public key, and put in .ssh/authorized_keys

    change visudo to use vim

    /boot/config.txt can need editting to get one-wire working .
    see https://www.raspberrypi.org/forums/viewtopic.php?f=37&t=98407
        http://raspberrypi.stackexchange.com/questions/26623/ds18b20-not-listed-in-sys-bus-w1-devices
    looks like i2c might need dtparam too.
    one wire needs this in the /boot/config.txt :
        dtoverlay=w1-gpio


i2c stuff :
    http://www.raspberrypi-spy.co.uk/2014/11/enabling-the-i2c-interface-on-the-raspberry-pi/
    https://www.raspberrypi.org/forums/viewtopic.php?f=44&t=91762&start=25

    getting i2c-0 working on Pi2 :
        add the kernel parm "bcm2708.vc_i2c_override=1" to /boot/cmdline.txt
        and "dtparam=i2c_vc=on" to /boot/config.txt



still to do :

    add a USB flash mem stick. (small one form factor ) 16 GB.
    get the USB mounting in /etc/fstab.


once fully setup "dd" the micro-sd card and get an image



setup bind9 DNS on piloft

    sudo apt-get install dnsutils bind9-doc bind9

    http://mixeduperic.com/ubuntu/seven-easy-steps-to-setting-up-an-interal-dns-server-on-ubuntu.html

    https://help.ubuntu.com/lts/serverguide/dns-installation.html

      sudo apt-get install bind9
      sudo apt-get update
      sudo apt-get install bind9
      sudo apt-get install dnsutils bind9-doc bind9
      sudo vim /etc/bind/named.conf.options
      sudo vim /etc/bind/named.conf.local
      sudo cp /etc/bind/db.local /etc/bind/db.khaos
      sudo vim /etc/bind/named.conf.local
      sudo vim /etc/bind/db.khaos
      sudo cp /etc/bind/db.127 /etc/bind/db.192
      sudo vim /etc/bind/db.192
      history
      sudo vim /etc/bind/db.192
      sudo /etc/init.d/bind9 start
      sudo vim /etc/resolv.conf
      dig distrowatch.com
      dig karlrad.khaos
      ping karlrad.khaos
      dig distrowatch.com
      ping karlrad.khaos
      dig karlrad.khaos
      ping karlrad
      history



the webserver
##############
    https://www.digitalocean.com/community/tutorials/how-to-create-a-ssl-certificate-on-apache-for-debian-8


    in /etc/apache2/mods-available/ssl.conf change :
        SSLProtocol all -SSLv3
            to :
        SSLProtocol all -TLSv1.2

    At the command line :
        cd /etc/apache2/mods-enabled
        sudo ln -s ../mods-available/ssl.conf
        sudo ln -s ../mods-available/ssl.load



    https://piserver.khaos/phpldapadmin/cmd.php
    https://www.digitalocean.com/community/tutorials/how-to-set-up-password-authentication-with-apache-on-ubuntu-14-04
    https://www.digitalocean.com/community/tutorials/how-to-install-and-configure-a-basic-ldap-server-on-an-ubuntu-12-04-vps

    symlinks from /var/www/


postgres db.
############

https://www.digitalocean.com/community/tutorials/how-to-install-and-use-postgresql-on-ubuntu-14-04


    https://www.digitalocean.com/community/tutorials/how-to-add-and-delete-users-on-an-ubuntu-14-04-vps
    create unix user names :

    pgread
    pgwrite

        postgres@piserver:~$ createuser --interactive
        Enter name of role to add: khaospy_read
        Shall the new role be a superuser? (y/n) n
        Shall the new role be allowed to create databases? (y/n) n
        Shall the new role be allowed to create more new roles? (y/n) n

        postgres@piserver:~$ createuser --interactive
        Enter name of role to add: khaospy_write
        Shall the new role be a superuser? (y/n) n
        Shall the new role be allowed to create databases? (y/n) n
        Shall the new role be allowed to create more new roles? (y/n) n


    stopped postgres server with

        sudo service postgres stop

    mkdir /media/120GB_ssd/postgres   ( on a usb attached SSD and not on pi main sd card )


    cd /media/120GB_ssd ;  chown postgres.postgres postgres

    cd /var/lib

    mv ./postgres/* /media/120GB_ssd/postgres

    in /etc/postgres/postgresql.conf changed the line to be :
        data_directory = '/media/120GB_ssd/postgresql/9.4/main'         # use data in another directory

 

